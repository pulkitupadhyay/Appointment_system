<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
    crossorigin="anonymous"
  />

  <style>
    h1 {
      text-align: center;
    }
    h2 {
      margin-top: 1%;
    }
    .mainDiv h2 {
      font-size: 1rem !important  ;
    }
    form input {
      font-size: 1rem !important  ;
    }
    .main {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #header {
      padding: 10px;
      color: #d36c6c;
      font-size: 26px;
      font-family: "Sora", sans-serif;
      font-weight: 800;
      display: flex;
      justify-content: space-between;
    }
    #header button {
      background-color: #92a1d1;
    }
    #container {
      width: 964px;
    }
    #weekdays {
      width: 100%;
      display: flex;
      color: #247ba0;
      font-weight: bold;
    }
    #weekdays div {
      width: 100px;
      padding: 50px;
      padding-bottom: 0px !important;
    }
    #calendar {
      width: 100%;
      margin: auto;
      display: flex;
      flex-wrap: wrap;
    }
    .day {
      width: 100px;
      padding: 10px;
      height: 100px;
      cursor: pointer;
      box-sizing: border-box;
      background-color: white;
      margin: 5px;
      box-shadow: 0px 0px 3px #cbd4c2;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .day:hover {
      background-color: rgba(211, 108, 108, 0.6) !important;
    }

    .day + #currentDay {
      background-color: #e8f4fa;
    }
    .event {
      font-size: 10px;
      padding: 3px;
      background-color: #58bae4;
      color: white;
      border-radius: 5px;
      max-height: 55px;
      overflow: hidden;
    }
    .padding {
      cursor: default !important;
      background-color: #fffcff !important;
      box-shadow: none !important;
    }
    #newEventModal,
    #deleteEventModal {
      display: none;
      z-index: 20;
      padding: 25px;
      background-color: #e8f4fa;
      box-shadow: 0px 0px 3px black;
      border-radius: 5px;
      width: 350px;
      top: 100px;
      left: calc(50% - 175px);
      position: absolute;
      font-family: sans-serif;
    }
    #eventTitleInput {
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 25px;
      border-radius: 3px;
      outline: none;
      border: none;
      box-shadow: 0px 0px 3px gray;
    }
    #eventTitleInput.error {
      border: 2px solid red;
    }
    #cancelButton,
    #deleteButton {
      background-color: #d36c6c;
    }
    #saveButton,
    #closeButton {
      background-color: #92a1d1;
    }
    #eventText {
      font-size: 14px;
    }
    #modalBackDrop {
      display: none;
      top: 0px;
      left: 0px;
      z-index: 10;
      width: 100vw;
      height: 100vh;
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
    }
    #header .icons {
      display: flex;
    }

    #header .icons span {
      height: 38px;
      width: 38px;
      margin: 0 1px;
      cursor: pointer;
      color: #000;
      text-align: center;
      line-height: 38px;
      font-size: 1.9rem;
      user-select: none;
      border-radius: 50%;
    }

    #header .icons span:last-child {
      margin-right: -10px;
    }

    #header .icons span:hover {
      background: rgb(202, 201, 201);
      /* color: rgba(247, 241, 241, 0.938);  */
      color: #d36c6c;
    }
  </style>
  <style>
    body {
      font-family: "Arial", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #f5f5f5;
    }

    form {
      display: flex;
      flex-direction: column;
      background-color: #fff;
      padding: 6px;
      width: 78%;
      border-radius: 15px;
      border: 2px solid rgb(65, 132, 242);
      /* box-shadow: 0 0 20px rgba(0, 0, 0, 0.2); */
    }

    input {
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
      outline: none;
    }

    #time-picker {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      margin-top: 5px;
      gap: 8px;
    }

    #hour,
    #minute {
      width: 30%;
    }

    span {
      font-size: 18px;
    }

    #ampm {
      width: 60px;
    }

    .fbtn {
      width: 100%;
      padding: 8px;
      background-color: #fff;
      color: #000;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .fbtn:hover {
      background-color: #9dc6ea;
    }

    .fbtn.clicked {
      background-color: #3498db;
      color: #000;
    }

    /* for responsiveness  */
    @media only screen and (min-width: 1024px) {
      .mt-4,
      .my-4 {
        margin-top: 10.5rem !important;
      }
    }
    @media only screen and (min-width: 1864px) {
      .mt-4,
      .my-4 {
        margin-top: 1.5rem !important;
      }
    }

    @media screen and (max-width: 768px) {
      .mainDiv {
        flex-direction: column;
        align-items: center;
        width: 90vw;
        height: 50vw;
      }

      .mainddddd {
        width: 100%;
        padding-top: 2%;
        height: 25rem;
      }

      #container {
        width: 100%;
      }

      #header {
        flex-direction: column;
      }

      #calendar {
        flex-direction: column;
      }

      .day {
        width: calc(20% - 10px);
        margin: 5px;
      }

      #newEventModal,
      #deleteEventModal {
        width: 80%;
        left: 10%;
      }
      form {
        width: 47%;
      }
      #time-picker {
        flex-direction: row;
        flex-wrap: wrap;
        align-content: center;
        justify-content: flex-end;
        margin-right: 35px;
      }
      .last_for_display_time {
        width: 100%;
      }
      #monthDisplay {
        margin-left: 15px;
        font-size: 20px;
        margin-top: 5px;
      }
    }
    /* #nextButton.material-symbols-rounded{
    margin-top: -35px;
    margin-left: 180px;
        } */

    .mainddddd {
      width: 90%;
      display: flex;
      flex-direction: row;
      box-shadow: 0rem 0.5rem 1.5rem 0.5rem rgba(167, 164, 164, 0.7) !important;
      padding: 1.5%;
    }
  </style>

  <style>
    body {
      font-family: "Arial", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #f5f5f5;
    }

    .mainDiv {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vw;
    }

    #container {
      width: 90%;
      max-width: 800px;
      margin: 0 auto;
    }

    #header {
      padding: 10px;
      background-color: #d36c6c;
      color: white;
      font-size: 18px;
      font-family: sans-serif;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    #header button {
      background-color: #92a1d1;
    }

    #weekdays,
    #calendar {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
    }

    #weekdays div,
    .day {
      width: calc(14.2857% - 10px);
      padding: 10px;
      margin: 5px;
    }

    .day {
      cursor: pointer;
      box-sizing: border-box;
      background-color: white;
      box-shadow: 0 5px 25px rgb(1 1 1 / 15%);
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border-bottom: 6px solid #4285f4;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: center;
    }

    .day:hover {
      background-color: #e8faed;
    }

    .day + #currentDay {
      background-color: #e8f4fa;
    }

    #newEventModal,
    #deleteEventModal {
      width: 80%;
      left: 10%;
    }

    .mainddddd {
      width: 100%;
      display: flex;
      flex-direction: row;
      box-shadow: 0rem 0.5rem 1.5rem 0.5rem rgba(167, 164, 164, 0.7) !important;
      padding: 1.5%;
      border: 2px solid #d36c6c;
    }

    @media screen and (max-width: 768px) {
      body {
        font-family: "Arial", sans-serif;
        /* display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh; */
        margin: 0;
        background-color: #f5f5f5;
        display: block;
      }

      .mainDiv {
        flex-direction: column;
        align-items: center;
        width: 90vw;
        height: 50vw;
      }
      /* .last_for_display_time{
  display: none;
} */
      .mainddddd {
        width: 90%;
        height: 100%;
        padding-top: 2%;
        /* height: 87vw; */
        flex-direction: column;
      }

      #container {
        width: 100%;
      }

      #header {
        flex-direction: row;
      }

      #calendar {
        flex-direction: row;
        gap: 2px;
      }

      .day {
        width: calc(20% - 10px);
        margin: 5px;
      }

      #newEventModal,
      #deleteEventModal {
        width: 80%;
        left: 10%;
      }
      #weekdays div,
      .day {
        width: calc(11% - 9px);
        margin-left: 4%;
        height: 8vw;
        align-items: center;
        margin-top: 8px;
      }
    }
  </style>

  <body>
    <%- include('./alert_msg.ejs') %>
    <div class="main">
      <% function capitalizeFirstLetter(str) { %> <% return str.replace(/^\w/,
      (c) => c.toUpperCase()); %> <%}%>

      <h1
        class="my-4"
        style="
          font-family: sans-serif;
          font-weight: bold;
          font-size: 1.5rem;
          text-shadow: 0rem 0.5rem 1.5rem #92a1d1;
        "
      >
        Book 1 Hour meeting with <%= capitalizeFirstLetter(employee.name); %>
      </h1>

      <div class="mainddddd">
        <div id="container">
          <div id="header">
            <div class="icons">
              <span id="backButton" class="material-symbols-rounded"
                >chevron_left</span
              >
            </div>
            <div id="monthDisplay"></div>
            <div class="icons">
              <span id="nextButton" class="material-symbols-rounded"
                >chevron_right</span
              >
            </div>
            <!-- <div>
      <button id="backButton">Back</button>
      <button id="nextButton">Next</button>
    </div> -->
          </div>

          <div id="weekdays">
            <div class="Sunday">Sunday</div>
            <div class="Monday">Monday</div>
            <div class="Tuesday">Tuesday</div>
            <div class="Wednesday">Wednesday</div>
            <div class="Thursday">Thursday</div>
            <div class="Friday">Friday</div>
            <div class="Saturday">Saturday</div>
          </div>

          <div id="calendar"></div>
        </div>

        <div id="newEventModal">
          <h2>New Event</h2>

          <input id="eventTitleInput" placeholder="Event Title" />

          <button id="saveButton">Save</button>
          <button id="cancelButton">Cancel</button>
        </div>

        <div id="deleteEventModal">
          <h2>Event</h2>

          <p id="eventText"></p>

          <button id="deleteButton">Delete</button>
          <button id="closeButton">Close</button>
        </div>

        <div id="modalBackDrop"></div>

        <div
          class="last_for_display_time"
          style="width: 295px; padding-top: 6%"
        ></div>
      </div>
    </div>

    <script>
      function changeColor(button) {
        button.classList.add("clicked");
      }
    </script>
    <script>
      let nav = 0;
      let clicked = null;

      const calendar = document.getElementById("calendar");
      const newEventModal = document.getElementById("newEventModal");
      const deleteEventModal = document.getElementById("deleteEventModal");
      const backDrop = document.getElementById("modalBackDrop");
      const eventTitleInput = document.getElementById("eventTitleInput");
      const weekdays = [
        "Sunday",
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
      ];

      function load() {
        const dt = new Date();
        // console.log("nav=", nav);
        dt.setDate(1);
        // console.log("DATE=", dt);

        // console.log("MONTH = ", dt.getMonth() , dt.getMonth() + nav);

        // dt.setMonth((new Date().getMonth()) + nav);
        dt.setMonth(dt.getMonth() + nav);
        // console.log(dt)

        const day = dt.getDate();
        const month = dt.getMonth();
        const year = dt.getFullYear();
        // const month1 = (dt.getMonth() + 1).toString().padStart(2, '0');

        // console.log(day,month,year )

        const firstDayOfMonth = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        // console.log(firstDayOfMonth, daysInMonth)

        const dateString = firstDayOfMonth.toLocaleDateString("en-us", {
          weekday: "long",
          year: "numeric",
          month: "numeric",
          day: "numeric",
        });
        // console.log('datestring'+ dateString)
        const paddingDays = weekdays.indexOf(dateString.split(", ")[0]);
        // console.log(paddingDays + 'a;sldkfja;sldkfj')
        document.getElementById(
          "monthDisplay"
        ).innerText = `${dt.toLocaleDateString("en-us", {
          month: "long",
        })} ${year}`;

        calendar.innerHTML = "";

        for (let i = 1; i <= paddingDays + daysInMonth; i++) {
          const daySquare = document.createElement("div");
          daySquare.classList.add("day");

          if (i > paddingDays) {
            daySquare.innerText = i - paddingDays;
            // const eventForDay = events.find(e => e.date === dayString);
            const dayString = `${i - paddingDays}/${month + 1}/${year}`;
            const parts = dayString.split("/");
            const formattedDate = `${parts[0].padStart(2, "0")}/${month + 1}/${
              parts[2]
            }`;
            //  console.log('this is daystring'+ formattedDate)

            daySquare.classList.add(`day_${i - paddingDays}`);
            const d = new Date();
            if (d.getDate() == i - paddingDays && d.getMonth() == month) {
              // console.log(,"month")

              daySquare.style.backgroundColor = "#89abc9";
            }

            function parseFormattedDateTime(formattedDate, formattedTime) {
    const [day, month, year] = formattedDate.split('/');
    const [hours, minutes] = formattedTime.split(':');
    return new Date(year, month - 1, day, hours, minutes);
}

function parseISODate(isoDateString) {
    return new Date(isoDateString);
}



function isDateTimeInArray(formattedDate, formattedTime) {

  function formatTimeFromJSDate(date) {
    // Get hours and minutes from the Date object
    const hours = date.getHours();
    const minutes = date.getMinutes();

    // Add leading zeros if needed
    const formattedHours = hours < 10 ? `0${hours}` : hours;
    const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;

    // Combine hours and minutes in "hh:mm" format
    const formattedTime = `${formattedHours}:${formattedMinutes}`;

    return formattedTime;
}
function formatDateFromString(dateString) {
    // Create a Date object from the input string
    const date = new Date(dateString);

    // Options for formatting the date
    const options = {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
    };

    // Format the date using local time zone
    const formattedDateString = date.toLocaleDateString(undefined, options);

    return formattedDateString;
}


  const array = JSON.parse(`<%- JSON.stringify(time_slots) %>`);

    const dateTimeToCheck = parseFormattedDateTime(formattedDate, formattedTime);

    console.log(array);

    const isMatchingDateTime = array.some(obj => {
        
      var fromDate = formatDateFromString(obj.from_date) 
      var timeDate = obj.time
      

      var timec = formatTimeFromJSDate(dateTimeToCheck)
      console.log("time",fromDate)
        // return isSameDateTime(fromDate, dateTimeToCheck) && isSameDateTime(timeDate, timec);
if(fromDate == formatDateFromString(dateTimeToCheck) && timeDate == timec){
  return true
}else{
  return false
}

    });

    console.log(isMatchingDateTime);

    return isMatchingDateTime;
}


            document.querySelector(".last_for_display_time").innerHTML = ``;

        var dddd = new Date()
        dddd.setHours(0, 0, 0, 0);
        dddd=dddd.getTime();
        var date_to_compare = new Date(year,(month),(i-paddingDays))
               date_to_compare.setHours(0, 0, 0, 0);
               date_to_compare=date_to_compare.getTime()
      console.log(dddd,date_to_compare,(i-paddingDays))


        if(date_to_compare >= dddd){


          daySquare.addEventListener("click", () => {
              // <input type="number" name="hour" id="hour" min="1" max="12" placeholder="HH" required>
              //         <span>:</span>
              //         <input type="number" id="minute" name="minute" min="0" max="59" placeholder="MM" required>
              //         <select id="ampm" name="ampm" >
              //             <option value="AM">AM</option>
              //             <option value="PM">PM</option>
              //         </select>

              // console.log(formattedDate)


                  var html_to_appent = ``;
                  

                  

// const dataString = JSON.stringify(formattedData);

                console.log(isDateTimeInArray(formattedDate,"12:00"))

                
                
                
                
                
                for(var k=0; k<=8; k++){

                    if(k==0){

                      if(!isDateTimeInArray(formattedDate,"12:00")){

                      var new_string =  `${formattedDate} <form action="/fake_login" method="post" >
      
                            <input type="string" name="date_of_ap" value="${formattedDate}" style="display:none;" >
                                   <input type="string" name="employee_id" value="<%=employee._id%>" style="display:none;"  >

     
        
                                 <input type="time" name="from_time" value="12:00" style="display:none;" >
                <button class="fbtn" type="submit" onclick="changeColor(this)">12:00 PM</button>
          
                                </form>`
                                console.log('k=0')
                      html_to_appent =`${html_to_appent} ${new_string}` ;
                    }else{
                      var new_string =  ` <form   style="background-color:red;" >
      
     



          
                        <button style="display:flex; flex-direction: column;justify-content:center;align-items:center;" class="fbtn" type="btn" onclick="changeColor(this)">12:00 PM <font> Already Occupied</font></button>


          </form>`
          console.log('k=0')
html_to_appent =`${html_to_appent} ${new_string}` ;
                    }
                   
                    }else{


                      if(!isDateTimeInArray(formattedDate,`${12+k}:00`)){
                        var new_string = ` <form action="/fake_login" method="post" >
      
      <input type="string" name="date_of_ap" value="${formattedDate}" style="display:none;" >
      <input type="string" name="employee_id" value="<%=employee._id%>" style="display:none;"  >

     
        
           <input type="time" name="from_time" value="${12+k}:00" style="display:none;" >
          <button class="fbtn" type="submit" onclick="changeColor(this)">0${k}:00 PM</button>
          
    </form>`

                                html_to_appent =`${html_to_appent} ${new_string}` ;


                      }

                      else{
                        var new_string =  ` <form style="background-color:red;" >
      
     



          
      <button style="display:flex; flex-direction: column;justify-content:center;align-items:center;" class="fbtn" type="btn" onclick="changeColor(this)">0${k}:00 PM <font> Already Occupied</font></button>
      
                </form>`
                console.log('k=0')
      html_to_appent =`${html_to_appent} ${new_string}` ;
                      }

                      



                    }



                  }
                  html_to_appent = ` <div id="time-picker">${html_to_appent} </div>`


              document.querySelector(".last_for_display_time").innerHTML = html_to_appent;
            });



        }





          } else {
            daySquare.classList.add("padding");
          }

          calendar.appendChild(daySquare);
        }
      }

      function initButtons() {
        document.getElementById("nextButton").addEventListener("click", () => {
          // console.log('button is clicked!!!!!!!!!!!!')
          nav++;
          load();
        });

        document.getElementById("backButton").addEventListener("click", () => {
          nav--;
          load();
        });
      }

      initButtons();

      load();

      function changeHeadingText() {
        var Sunday = document.querySelector(".Sunday");
        var Monday = document.querySelector(".Monday");
        var Tuesday = document.querySelector(".Tuesday");
        var Wednesday = document.querySelector(".Wednesday");
        var Thursday = document.querySelector(".Thursday");
        var Friday = document.querySelector(".Friday");
        var Saturday = document.querySelector(".Saturday");

        var windowWidth = window.innerWidth;

        if (windowWidth <= 768) {
          Sunday.textContent = "Sun";
          Monday.textContent = "Mon";
          Tuesday.textContent = "Teu";
          Wednesday.textContent = "Wed";
          Thursday.textContent = "Thu";
          Friday.textContent = "Fri";
          Saturday.textContent = "Sat";
        }
      }

        // Run the function on page load and window resize
        window.addEventListener('load', changeHeadingText);
        window.addEventListener('resize', changeHeadingText);


</script>
<script>
  function changeColor(button) {
      var buttons = document.querySelectorAll('.navbar a');
      buttons.forEach(function(btn) {
          btn.classList.remove('clicked');
      });
      button.classList.add('clicked');
  }
</script>

    <script>
      const mainDiv = document.querySelector(".mainDiv");
      const childDivs = Array.from(mainDiv.children);

      childDivs.sort((a, b) => {
        const dateA = parseDate(a.querySelector("h1").textContent);
        const dateB = parseDate(b.querySelector("h1").textContent);
        return dateA - dateB;
      });

      childDivs.forEach((div) => mainDiv.appendChild(div));

      function parseDate(dateString) {
        const [day, month, year] = dateString.split("/").map(Number);
        return new Date(year + 2000, month - 1, day); // Converting to comparable format
      }
    </script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
